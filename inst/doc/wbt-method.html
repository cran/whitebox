<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>wbt() method: call ‘Whitebox’ tools by name</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore"><code>wbt()</code> method: call ‘Whitebox’
tools by name</h1>



<div id="wbt" class="section level1">
<h1><code>wbt()</code></h1>
<p>The <code>wbt()</code> method is a high-level wrapper function to
manage flow of information between R and WhiteboxTools. With
<code>wbt()</code> one can run sequential analyses in Whitebox while
having R prepare inputs, generate commands, and visualize results.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(whitebox)</span></code></pre></div>
<div id="getting-started" class="section level2">
<h2>Getting Started</h2>
<p>Know what tool you want to run but <em>can’t remember the required
parameters</em>? Just type <code>wbt(&quot;toolname&quot;)</code></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co">#&gt; Required arguments:</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt; - [ ] dem -- Input raster DEM file.</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt; - [ ] output -- Output raster file.</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; Optional arguments:</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; - [ ] zfactor -- Optional multiplier for when the vertical and horizontal units are not the same.</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; - [ ] units -- Units of output raster; options include &#39;degrees&#39;, &#39;radians&#39;, &#39;percent&#39;</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt; No parameters (Slope)</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;  Slope ERROR: &#39;dem&#39;, &#39;output&#39; required</span></span></code></pre></div>
<p>Output produced on error and with invalid arguments helps guide use
interactively by prompting with required and optional arguments as a
checklist.</p>
</div>
<div id="result-objects" class="section level2">
<h2>Result Objects</h2>
<p>All calls to <code>wbt()</code> return an S3 object with class
<code>wbt_result</code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># get file path of sample DEM</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">sample_dem_data</span>()</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> dem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>))</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.13s</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; dem  : &#39;/tmp/Rtmp5srhl0/Rinst1cbca81a9b21/whitebox/extdata/DEM.tif&#39;</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/slope.tif&#39; </span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;   File result:  //tmp/RtmpsDUR6u/slope.tif exists (Last modified: 2024-05-26 17:10:48.209155)</span></span></code></pre></div>
<p>Whether a system call succeeds or fails the parameters that were
passed to the WhiteboxTools executable and references to any output file
paths that were specified are returned. If output files reference
spatial data (e.g. a GeoTIFF file) they may be converted to a file-based
R object providing information about the result.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">goof =</span> dem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>))</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt; Error: invalid parameter &#39;goof&#39;</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; Required arguments:</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; - [ ] dem -- Input raster DEM file.</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; - [*] output -- Output raster file.</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; Optional arguments:</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="co">#&gt; - [ ] zfactor -- Optional multiplier for when the vertical and horizontal units are not the same.</span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; - [ ] units -- Units of output raster; options include &#39;degrees&#39;, &#39;radians&#39;, &#39;percent&#39;</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; goof : &#39;/tmp/Rtmp5srhl0/Rinst1cbca81a9b21/whitebox/extdata/DEM.tif&#39;</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/slope.tif&#39; </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;  Slope ERROR: &#39;goof&#39; invalid; &#39;dem&#39; required</span></span></code></pre></div>
<p>When a call fails an informative error message issued, and the error
will be cached inside the result. Prior runs references are stored as
well for sequential tool runs; more on that below.</p>
<div id="wbt_result-class" class="section level3">
<h3><code>wbt_result</code> class</h3>
<p>A <code>wbt_result</code> class object is a base R
<code>list()</code> with standard element names (<code>&quot;tool&quot;</code>,
<code>&quot;args&quot;</code>, <code>&quot;stdout&quot;</code>, <code>&quot;crs&quot;</code>,
<code>&quot;result&quot;</code>, <code>&quot;history&quot;</code>) and the
<code>&quot;class&quot;</code> attribute <code>&quot;wbt_result&quot;</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> dem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>)), <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.12s</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; List of 6</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co">#&gt;  $ tool   : chr &quot;Slope&quot;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co">#&gt;  $ args   : chr &quot;--dem=/tmp/Rtmp5srhl0/Rinst1cbca81a9b21/whitebox/extdata/DEM.tif --output=/tmp/RtmpsDUR6u/slope.tif&quot;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a><span class="co">#&gt;  $ stdout : chr &quot;Slope - Elapsed Time (excluding I/O): 0.12s&quot;</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;  $ crs    : chr &quot;&quot;</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;package&quot;)= Named chr &quot;&quot;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt;   .. ..- attr(*, &quot;names&quot;)= chr &quot;dem&quot;</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt;  $ result :List of 1</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt;  $ history:List of 1</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr &quot;wbt_result&quot;</span></span></code></pre></div>
<p>Any <code>output</code> produced by the tool (usually file paths set
by the user) will be included in the <code>wbt_result$result</code>
list.</p>
</div>
<div id="wbt_result-on-error" class="section level3">
<h3><code>wbt_result</code> on error</h3>
<p>If there is an error a <code>try-error</code> class object with an
error message is returned in lieu of a list in <code>$result</code></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># on error there is a try-error object in $result</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; Required arguments:</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; - [ ] dem -- Input raster DEM file.</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; - [ ] output -- Output raster file.</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; Optional arguments:</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; - [ ] zfactor -- Optional multiplier for when the vertical and horizontal units are not the same.</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt; - [ ] units -- Units of output raster; options include &#39;degrees&#39;, &#39;radians&#39;, &#39;percent&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">inherits</span>(x<span class="sc">$</span>result, <span class="st">&#39;try-error&#39;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">message</span>(x<span class="sc">$</span>result[<span class="dv">1</span>])</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; ERROR: &#39;dem&#39;, &#39;output&#39; required</span></span></code></pre></div>
</div>
</div>
<div id="vignette-topics" class="section level2">
<h2>Vignette Topics</h2>
<p>We now will cover how the <code>wbt()</code> method and
<code>wbt_result</code> class can be used for the following:</p>
<ul>
<li><p>Input and Output with R spatial objects</p></li>
<li><p>Running Sequences of Tools (optionally: with pipe
<code>|&gt;</code> or <code>%&gt;%</code>)</p></li>
<li><p>Handling Coordinate Reference Systems</p></li>
</ul>
</div>
</div>
<div id="input-and-output-with-r-spatial-objects" class="section level1">
<h1>Input and Output with R spatial objects</h1>
<p>A feature of <code>wbt()</code> is that it handles input/output and
file name management if you are using R objects as input. It can be an
onerous task to manage files for workflows involving many tool runs.</p>
<p>If you use a <code>terra</code> object as input, you will get a
<code>SpatRaster</code>. If you use a <code>raster</code> object as your
input object frontend, you will get a <code>RasterLayer</code> object as
output for tools that produce a raster. There will be file paths
associated with that R object.</p>
<div id="compare-raster-and-terra-as-r-raster-object-frontends" class="section level3">
<h3>Compare <code>raster</code> and <code>terra</code> as R raster
object frontends</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;raster&quot;</span>)) {</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>  rdem <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">raster</span>(dem)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="co"># raster input; raster output</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  r1 <span class="ot">&lt;-</span> <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> rdem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>))</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>  r1</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  <span class="fu">class</span>(r1<span class="sc">$</span>result<span class="sc">$</span>output)</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>}</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; Loading required namespace: raster</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.14s</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;RasterLayer&quot;</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;package&quot;)</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;raster&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>tdem <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(dem)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">## terra input; terra output</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>t1 <span class="ot">&lt;-</span> <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> tdem, <span class="at">output =</span>  <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>))</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.12s</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>t1</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; dem  : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0c3e5c9f9c.tif&#39;</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/slope.tif&#39; </span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt; dimensions  : 188, 237, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt; resolution  : 90, 90  (x, y)</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; extent      : 664692, 686022, 4878904, 4895824  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; coord. ref. : NAD83 / UTM zone 18N (EPSG:26918) </span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt; source      : slope.tif </span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="co">#&gt; name        : slope</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">class</span>(t1<span class="sc">$</span>result<span class="sc">$</span>output)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;SpatRaster&quot;</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; attr(,&quot;package&quot;)</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;terra&quot;</span></span></code></pre></div>
<p>The user still needs to specify paths but <code>wbt()</code> eases
the process of converting input objects to paths and reading output
paths to R objects after the tool has run. In principle any R object
that references a file with type that Whitebox supports can be handled
under the current (simple; proof of concept) system. Using file-based
representations may not be the most efficient, but allows for a tangible
trail of the steps in a workflow to be followed that otherwise might be
hard to track.</p>
</div>
</div>
<div id="wbt_source-rasters-in-memory-and-vector-data" class="section level1">
<h1><code>wbt_source()</code>: rasters in memory, and vector data</h1>
<p>The terra and raster packages use pointers to a file/raster
connection except when a grid is entirely in memory. Processing these
types of rasters with whitebox requires writing out as a temporary
GeoTIFF file for tool input. In general <code>wbt()</code> can handle
this for you.</p>
<p>Vector data (point, line and polygon geometries) are commonly stored
stored in sf data.frames, sp objects, or terra SpatVector objects. These
types are read into memory on creation.</p>
<p>Reading vector data into R memory is not needed to run Whitebox
tools, so <code>wbt_source()</code> provides a means to annotate objects
with information about source file path (similar to how terra/raster
handle raster sources) such that they can be processed further by
<code>wbt()</code> with minimal overhead. Objects like the terra
SpatVectorProxy use delayed read by default. Passing a file path to
<code>wbt_source()</code> will create a SpatVectorProxy with necessary
information for use with <code>wbt()</code>.</p>
<p>For instance, we can create a reference for a sample ESRI Shapefile
via <code>wbt_source()</code>. The result is a SpatVectorProxy.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>shp <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;ex/lux.shp&quot;</span>, <span class="at">package =</span> <span class="st">&quot;terra&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">wbt_source</span>(shp)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>x</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt;  class       : SpatVectorProxy</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt;  geometry    : polygons </span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;  dimensions  : 12, 6  (geometries, attributes)</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;  extent      : 5.74414, 6.528252, 49.44781, 50.18162  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;  source      : lux.shp</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt;  coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;  names       :  ID_1 NAME_1  ID_2 NAME_2  AREA   POP</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt;  type        : &lt;num&gt;  &lt;chr&gt; &lt;num&gt;  &lt;chr&gt; &lt;num&gt; &lt;int&gt;</span></span></code></pre></div>
<p>The SpatVectorProxy provides a light-weight means to create an R
object reference to a large file; allowing the “heavy” lifting for that
file to be done primarily by WhiteboxTools (or GDAL via {terra}).</p>
<p>At time of writing this document, WhiteboxTools does not support
vector data inputs other than Shapefile. If we have, for example, a
GeoPackage, <code>wbt_source()</code> will convert the input to a
temporary shapefile and return a SpatVectorProxy that references that
file. This object can then be used as input to <code>wbt()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># load the data</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">query</span>(x)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># remove area column</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>x2<span class="sc">$</span>AREA <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co"># create a GeoPackage</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">writeVector</span>(x2, <span class="at">filename =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;lux.gpkg&quot;</span>), <span class="at">overwrite =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt; Warning in x@ptr$write(filename, layer, filetype, insert[1], overwrite[1], :</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt; GDAL Message 6: dataset /tmp/RtmpsDUR6u/lux.gpkg does not support layer</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; creation option ENCODING</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="co"># now the source is a temporary .shp</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>x3 <span class="ot">&lt;-</span> <span class="fu">wbt_source</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;lux.gpkg&quot;</span>))</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;polygon_area&quot;</span>, <span class="at">input =</span> x3)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; PolygonArea - Elapsed Time: 0.0s</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (PolygonArea) ---</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="co">#&gt; input    : &#39;/tmp/RtmpsDUR6u/lux.gpkg_file1cc0c690afdce.shp&#39; </span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="co">#&gt;  class       : SpatVectorProxy</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co">#&gt;  geometry    : polygons </span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co">#&gt;  dimensions  : 12, 6  (geometries, attributes)</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="co">#&gt;  extent      : 5.74414, 6.528252, 49.44781, 50.18162  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="co">#&gt;  source      : lux.gpkg_file1cc0c690afdce.shp</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="co">#&gt;  coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="co">#&gt;  names       :  ID_1 NAME_1  ID_2 NAME_2   POP  AREA</span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="co">#&gt;  type        : &lt;num&gt;  &lt;chr&gt; &lt;num&gt;  &lt;chr&gt; &lt;int&gt; &lt;num&gt;</span></span></code></pre></div>
</div>
<div id="running-sequences-of-tools" class="section level1">
<h1>Running Sequences of Tools</h1>
<p>When you call <code>wbt()</code> and the first argument is a
<code>wbt_result</code> the <code>output</code> from the input
<code>wbt_result</code> is passed as the first <code>input</code> to the
new tool run.</p>
<p>This general “pass the output as the first input” works even if the
first <code>input</code> parameter (<code>&quot;-i&quot;</code> flag) is something
different such as <code>dem</code> or <code>input1</code>.</p>
<p>This makes it possible to chain different operations together in a
sequence.</p>
<p>If all of the required parameters are specified the tool will be
run.</p>
<p>Here we run “Slope” on a DEM, then run “Slope” on it again to get a
second derivative “curvature”.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> dem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>))</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.13s</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>x2 <span class="ot">&lt;-</span> <span class="fu">wbt</span>(x, <span class="at">tool_name =</span> <span class="st">&quot;slope&quot;</span>, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;curvature.tif&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.5s</span></span></code></pre></div>
<div id="using-pipes" class="section level2">
<h2>Using pipes</h2>
<p>Nested chained operation syntax can be transformed to use pipe
operators ({base} R 4.1+ <code>|&gt;</code> or {magrittr}
<code>%&gt;%</code>). This can improve the readability of the code
(fewer nested parentheses) and the first argument transfer behavior
allows results from each step to be transferred to the input of the
next.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> dem, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;slope.tif&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;curvature.tif&quot;</span>))</span></code></pre></div>
<p>The <code>wbt_result</code> output that prints to the console will
reflect the input/output parameters of the most recent tool run in a
tool chain.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>x2</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt; dem  : &#39;//tmp/RtmpsDUR6u/slope.tif&#39;</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/curvature.tif&#39; </span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt;   File result:  //tmp/RtmpsDUR6u/curvature.tif exists (Last modified: 2024-05-26 17:10:50.929171)</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; --- HISTORY ---</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; Prior results (n=1) for: Slope </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt;  - Slope (output&lt;character&gt;)</span></span></code></pre></div>
<p><code>wbt_result()</code> is the method to get <code>$result</code>
for single runs or all <code>$result</code> in <code>$history</code> for
chained runs from a <code>wbt_result</code> object.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">str</span>(<span class="fu">wbt_result</span>(x2), <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt;  chr [1:2] &quot;//tmp/RtmpsDUR6u/slope.tif&quot; &quot;//tmp/RtmpsDUR6u/curvature.tif&quot;</span></span></code></pre></div>
<p>The <code>$history</code> element is a list of the
<code>wbt_result</code> from individual runs.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">str</span>(x2<span class="sc">$</span>history, <span class="at">max.level =</span> <span class="dv">1</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#&gt; List of 2</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt;  $ :List of 5</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;class&quot;)= chr &quot;wbt_result&quot;</span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt;  $ :List of 5</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt;   ..- attr(*, &quot;class&quot;)= chr &quot;wbt_result&quot;</span></span></code></pre></div>
<p>If you pass invalid results from one step to the next, you get an
informative error message.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt; Required arguments:</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; - [ ] dem -- Input raster DEM file.</span></span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a><span class="co">#&gt; - [ ] output -- Output raster file.</span></span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a><span class="co">#&gt; Optional arguments:</span></span>
<span id="cb22-7"><a href="#cb22-7" tabindex="-1"></a><span class="co">#&gt; - [ ] zfactor -- Optional multiplier for when the vertical and horizontal units are not the same.</span></span>
<span id="cb22-8"><a href="#cb22-8" tabindex="-1"></a><span class="co">#&gt; - [ ] units -- Units of output raster; options include &#39;degrees&#39;, &#39;radians&#39;, &#39;percent&#39;</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">wbt</span>(x, <span class="st">&quot;slope&quot;</span>, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;foo.tif&quot;</span>))</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: try-error result cannot be used as `dem`</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt; Required arguments:</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt; - [ ] dem -- Input raster DEM file.</span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt; - [*] output -- Output raster file.</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt; Optional arguments:</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt; - [ ] zfactor -- Optional multiplier for when the vertical and horizontal units are not the same.</span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; - [ ] units -- Units of output raster; options include &#39;degrees&#39;, &#39;radians&#39;, &#39;percent&#39;</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/foo.tif&#39; </span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a><span class="co">#&gt;  Slope ERROR: &#39;dem&#39; required </span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a><span class="co">#&gt; --- HISTORY ---</span></span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a><span class="co">#&gt; Prior results (n=1) for: Slope </span></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="co">#&gt;  - Slope (&lt;character&gt;)</span></span></code></pre></div>
</div>
</div>
<div id="coordinate-reference-systems-crs" class="section level1">
<h1>Coordinate Reference Systems (CRS)</h1>
<p>On top of handling file paths it is necessary for Geographic
Information Systems to handle Coordinate Reference System (CRS)
information. Many R tools in the GDAL/PROJ sphere require valid CRS to
operate.</p>
<p>WhiteboxTools will read the GeoKey information from your
<em>GeoTIFF</em> files specified by path and propagate that to the
output file result. When you read those files with R, you should find
that the original file’s CRS has been transferred.</p>
<p><code>wbt()</code> and <code>wbt_result</code> help ensure consistent
file and CRS information across sequences of operations and within
calls–especially those <em>involving R spatial objects</em>.</p>
<p>If you specified the CRS in R, or made the raster entirely in R, you
might need a hand setting up the file-based representation that
WhiteboxTools will use. This is easy enough to do with
<code>crs()</code>, <code>writeRaster()</code> and the equivalent but
often requires more boilerplate code than just specifying the argument,
or having CRS propagate from input.</p>
<p>For inputs that have a file-based representation
(e.g. <code>RasterLayer</code> and <code>SpatRaster</code> objects)
<code>wbt()</code> provides an interface where R objects can be
substituted for file names and vice versa. User and workflow level
attributes like CRS and working directory be handled at the same
time.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>dem <span class="ot">&lt;-</span> <span class="fu">sample_dem_data</span>()</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="do">## equivalent to:</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co"># dem &lt;- system.file(&quot;extdata/DEM.tif&quot;, package = &quot;whitebox&quot;)</span></span></code></pre></div>
<p>In the process of reading/writing files that may contain CRS
information, such as this sample DEM, the CRS can be inspected, modified
and propagated to file or R objects.</p>
<div id="setting-the-crs" class="section level2">
<h2>Setting the CRS</h2>
<p>If the CRS is specified in the input <code>SpatRaster</code> object,
<code>wbt()</code> makes sure it is propagated to the R object result.
<code>wbt()</code> does not alter or copy the source or output files
which may or may not have CRS information.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>araster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(dem)</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> araster, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;foo.tif&quot;</span>))</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.15s</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; dem  : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0cf4d812c.tif&#39;</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/foo.tif&#39; </span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt; dimensions  : 188, 237, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="co">#&gt; resolution  : 90, 90  (x, y)</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">#&gt; extent      : 664692, 686022, 4878904, 4895824  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="co">#&gt; coord. ref. : NAD83 / UTM zone 18N (EPSG:26918) </span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="co">#&gt; source      : foo.tif </span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="co">#&gt; name        : foo</span></span></code></pre></div>
<p>Alternately you can specify the <code>crs</code> argument to
<code>wbt()</code> instead of <code>rast()</code>. This will directly
set the <code>crs</code> element of the <code>wbt_result</code> of your
output.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;slope&quot;</span>, <span class="at">dem =</span> terra<span class="sc">::</span><span class="fu">rast</span>(dem), <span class="at">crs =</span> <span class="st">&quot;EPSG:26918&quot;</span>, <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;foo.tif&quot;</span>))</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt; Slope - Elapsed Time (excluding I/O): 0.12s</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Slope) ---</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="co">#&gt; dem  : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0c552f49c7.tif&#39;</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/foo.tif&#39; </span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a><span class="co">#&gt; dimensions  : 188, 237, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a><span class="co">#&gt; resolution  : 90, 90  (x, y)</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a><span class="co">#&gt; extent      : 664692, 686022, 4878904, 4895824  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="co">#&gt; coord. ref. : NAD83 / UTM zone 18N (EPSG:26918) </span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="co">#&gt; source      : foo.tif </span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="co">#&gt; name        : foo</span></span></code></pre></div>
<p>In either case wherever you specify the <code>crs</code> argument the
<code>crs</code> is stored in the <code>wbt_result</code> and propagated
to the relevant output. Again, the source files are unchanged if they
had no CRS or invalid CRS (until you write that updated CRS to
file).</p>
<p>If two input R objects have different (or no) CRS then the
<code>wbt()</code> method will provide a message to the user:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(dem) <span class="co"># default: EPSG:26918</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">deepcopy</span>(r1)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">crs</span>(r2) <span class="ot">&lt;-</span> <span class="st">&quot;EPSG:26917&quot;</span> <span class="co"># something else/wrong</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;add&quot;</span>, </span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="at">input1 =</span> r1, </span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>    <span class="at">input2 =</span> r2, </span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>    <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;foo.tif&quot;</span>)</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>   )</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: Input CRS do not match.</span></span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a><span class="co">#&gt; Add - Elapsed Time (excluding I/O): 0.1s</span></span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Add) ---</span></span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a><span class="co">#&gt; input1   : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0c6543aade.tif&#39;</span></span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a><span class="co">#&gt; input2   : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0c1cb97649.tif&#39;</span></span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/foo.tif&#39; </span></span>
<span id="cb27-16"><a href="#cb27-16" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb27-17"><a href="#cb27-17" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb27-18"><a href="#cb27-18" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb27-19"><a href="#cb27-19" tabindex="-1"></a><span class="co">#&gt; dimensions  : 188, 237, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb27-20"><a href="#cb27-20" tabindex="-1"></a><span class="co">#&gt; resolution  : 90, 90  (x, y)</span></span>
<span id="cb27-21"><a href="#cb27-21" tabindex="-1"></a><span class="co">#&gt; extent      : 664692, 686022, 4878904, 4895824  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb27-22"><a href="#cb27-22" tabindex="-1"></a><span class="co">#&gt; coord. ref. : NAD83 / UTM zone 18N (EPSG:26918) </span></span>
<span id="cb27-23"><a href="#cb27-23" tabindex="-1"></a><span class="co">#&gt; source      : foo.tif </span></span>
<span id="cb27-24"><a href="#cb27-24" tabindex="-1"></a><span class="co">#&gt; name        : foo</span></span></code></pre></div>
<p>This message is suppressed and output CRS set accordingly if the
<code>crs</code> argument is specified. This user set CRS is only in the
SpatRaster object, and does not necessarily match that of the file used
as input or returned as output.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="fu">wbt</span>(<span class="st">&quot;add&quot;</span>, </span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>    <span class="at">input1 =</span> r1,</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>    <span class="at">input2 =</span> r2, </span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>    <span class="at">crs =</span> <span class="st">&quot;EPSG:26918&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>    <span class="at">output =</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&quot;foo.tif&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a>   )</span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co">#&gt; Add - Elapsed Time (excluding I/O): 0.1s</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co">#&gt; &lt;wbt_result&gt;</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a><span class="co">#&gt; --- PARAMETERS (Add) ---</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a><span class="co">#&gt; input1   : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0c72c5d7da.tif&#39;</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a><span class="co">#&gt; input2   : &#39;/tmp/Rtmp5srhl0/Rbuild1cbcad2c685a/whitebox/vignettes/file1cc0cc90771a.tif&#39;</span></span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a><span class="co">#&gt; output   : &#39;/tmp/RtmpsDUR6u/foo.tif&#39; </span></span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co">#&gt; --- RESULT ---</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a><span class="co">#&gt; $output</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a><span class="co">#&gt; dimensions  : 188, 237, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a><span class="co">#&gt; resolution  : 90, 90  (x, y)</span></span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a><span class="co">#&gt; extent      : 664692, 686022, 4878904, 4895824  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co">#&gt; coord. ref. : NAD83 / UTM zone 18N (EPSG:26918) </span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a><span class="co">#&gt; source      : foo.tif </span></span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a><span class="co">#&gt; name        : foo</span></span></code></pre></div>
<p><!--
# Future Plans

Future additions to this vignette may include:

 - Managing WhiteboxTools working directories

 - Managing WhiteboxTools file types
 
In the future users will be able to:

 - Set a temporary or persistent working
directory and have output file paths/names auto-generated, allowing them to
work entirely with R objects and `wbt_result` while making an intermediate file
record in the background.

 - Use a wrapper class for generic
groups of Whitebox file types; allowing file name references for any R object
or output file type to be stored: optimized/customizable read/write methods used for
specific file types and generic .rda files with metadata for others.

 - Batch of tool runs on e.g. watershed extents --></p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
